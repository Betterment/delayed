snapshots["runs the expected postgresql query for count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, \"delayed_jobs\".\"queue\" AS delayed_jobs_queue
  FROM \"delayed_jobs\"
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected postgresql query for future_count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, \"delayed_jobs\".\"queue\" AS delayed_jobs_queue
  FROM \"delayed_jobs\"
  WHERE \"delayed_jobs\".\"run_at\" > '2025-11-10 17:20:13'
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected postgresql query for locked_count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, \"delayed_jobs\".\"queue\" AS delayed_jobs_queue
  FROM \"delayed_jobs\"
  WHERE \"delayed_jobs\".\"locked_at\" IS NOT NULL
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected postgresql query for erroring_count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, \"delayed_jobs\".\"queue\" AS delayed_jobs_queue
  FROM \"delayed_jobs\"
  WHERE \"delayed_jobs\".\"last_error\" IS NOT NULL
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected postgresql query for failed_count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, \"delayed_jobs\".\"queue\" AS delayed_jobs_queue
  FROM \"delayed_jobs\"
  WHERE \"delayed_jobs\".\"failed_at\" IS NOT NULL
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected postgresql query for max_lock_age 1"] = <<-SNAP
SELECT CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS priority, queue, MIN(locked_at) AS locked_at
  FROM \"delayed_jobs\"
  WHERE \"delayed_jobs\".\"locked_at\" IS NOT NULL
    AND \"delayed_jobs\".\"failed_at\" IS NULL
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected postgresql query for max_age 1"] = <<-SNAP
SELECT (CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END) AS priority, queue, MIN(run_at) AS run_at
  FROM \"delayed_jobs\"
  WHERE \"delayed_jobs\".\"locked_at\" IS NULL
    AND \"delayed_jobs\".\"failed_at\" IS NULL
    AND \"delayed_jobs\".\"run_at\" <= '2025-11-10 17:20:13'
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected postgresql query for working_count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, \"delayed_jobs\".\"queue\" AS delayed_jobs_queue
  FROM \"delayed_jobs\"
  WHERE \"delayed_jobs\".\"locked_at\" IS NOT NULL
    AND \"delayed_jobs\".\"failed_at\" IS NULL
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected postgresql query for workable_count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, \"delayed_jobs\".\"queue\" AS delayed_jobs_queue
  FROM \"delayed_jobs\"
  WHERE \"delayed_jobs\".\"locked_at\" IS NULL
    AND \"delayed_jobs\".\"failed_at\" IS NULL
    AND \"delayed_jobs\".\"run_at\" <= '2025-11-10 17:20:13'
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected postgresql query for alert_age_percent 1"] = <<-SNAP
SELECT (CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END) AS priority, queue, MIN(run_at) AS run_at
  FROM \"delayed_jobs\"
  WHERE \"delayed_jobs\".\"locked_at\" IS NULL
    AND \"delayed_jobs\".\"failed_at\" IS NULL
    AND \"delayed_jobs\".\"run_at\" <= '2025-11-10 17:20:13'
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected sqlite3 query for count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, \"delayed_jobs\".\"queue\" AS delayed_jobs_queue
  FROM \"delayed_jobs\"
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected sqlite3 query for future_count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, \"delayed_jobs\".\"queue\" AS delayed_jobs_queue
  FROM \"delayed_jobs\"
  WHERE \"delayed_jobs\".\"run_at\" > '2025-11-10 17:20:13'
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected sqlite3 query for locked_count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, \"delayed_jobs\".\"queue\" AS delayed_jobs_queue
  FROM \"delayed_jobs\"
  WHERE \"delayed_jobs\".\"locked_at\" IS NOT NULL
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected sqlite3 query for erroring_count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, \"delayed_jobs\".\"queue\" AS delayed_jobs_queue
  FROM \"delayed_jobs\"
  WHERE \"delayed_jobs\".\"last_error\" IS NOT NULL
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected sqlite3 query for failed_count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, \"delayed_jobs\".\"queue\" AS delayed_jobs_queue
  FROM \"delayed_jobs\"
  WHERE \"delayed_jobs\".\"failed_at\" IS NOT NULL
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected sqlite3 query for max_lock_age 1"] = <<-SNAP
SELECT CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS priority, queue, MIN(locked_at) AS locked_at
  FROM \"delayed_jobs\"
  WHERE \"delayed_jobs\".\"locked_at\" IS NOT NULL
    AND \"delayed_jobs\".\"failed_at\" IS NULL
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected sqlite3 query for max_age 1"] = <<-SNAP
SELECT (CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END) AS priority, queue, MIN(run_at) AS run_at
  FROM \"delayed_jobs\"
  WHERE \"delayed_jobs\".\"locked_at\" IS NULL
    AND \"delayed_jobs\".\"failed_at\" IS NULL
    AND \"delayed_jobs\".\"run_at\" <= '2025-11-10 17:20:13'
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected sqlite3 query for working_count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, \"delayed_jobs\".\"queue\" AS delayed_jobs_queue
  FROM \"delayed_jobs\"
  WHERE \"delayed_jobs\".\"locked_at\" IS NOT NULL
    AND \"delayed_jobs\".\"failed_at\" IS NULL
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected sqlite3 query for workable_count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, \"delayed_jobs\".\"queue\" AS delayed_jobs_queue
  FROM \"delayed_jobs\"
  WHERE \"delayed_jobs\".\"locked_at\" IS NULL
    AND \"delayed_jobs\".\"failed_at\" IS NULL
    AND \"delayed_jobs\".\"run_at\" <= '2025-11-10 17:20:13'
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected sqlite3 query for alert_age_percent 1"] = <<-SNAP
SELECT (CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END) AS priority, queue, MIN(run_at) AS run_at
  FROM \"delayed_jobs\"
  WHERE \"delayed_jobs\".\"locked_at\" IS NULL
    AND \"delayed_jobs\".\"failed_at\" IS NULL
    AND \"delayed_jobs\".\"run_at\" <= '2025-11-10 17:20:13'
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, \"delayed_jobs\".\"queue\"
SNAP

snapshots["runs the expected mysql2 query for count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, `delayed_jobs`.`queue` AS delayed_jobs_queue
  FROM `delayed_jobs`
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, `delayed_jobs`.`queue`
SNAP

snapshots["runs the expected mysql2 query for future_count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, `delayed_jobs`.`queue` AS delayed_jobs_queue
  FROM `delayed_jobs`
  WHERE `delayed_jobs`.`run_at` > '2025-11-10 17:20:13'
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, `delayed_jobs`.`queue`
SNAP

snapshots["runs the expected mysql2 query for locked_count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, `delayed_jobs`.`queue` AS delayed_jobs_queue
  FROM `delayed_jobs`
  WHERE `delayed_jobs`.`locked_at` IS NOT NULL
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, `delayed_jobs`.`queue`
SNAP

snapshots["runs the expected mysql2 query for erroring_count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, `delayed_jobs`.`queue` AS delayed_jobs_queue
  FROM `delayed_jobs`
  WHERE `delayed_jobs`.`last_error` IS NOT NULL
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, `delayed_jobs`.`queue`
SNAP

snapshots["runs the expected mysql2 query for failed_count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, `delayed_jobs`.`queue` AS delayed_jobs_queue
  FROM `delayed_jobs`
  WHERE `delayed_jobs`.`failed_at` IS NOT NULL
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, `delayed_jobs`.`queue`
SNAP

snapshots["runs the expected mysql2 query for max_lock_age 1"] = <<-SNAP
SELECT CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS priority, queue, MIN(locked_at) AS locked_at
  FROM `delayed_jobs`
  WHERE `delayed_jobs`.`locked_at` IS NOT NULL
    AND `delayed_jobs`.`failed_at` IS NULL
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, `delayed_jobs`.`queue`
SNAP

snapshots["runs the expected mysql2 query for max_age 1"] = <<-SNAP
SELECT (CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END) AS priority, queue, MIN(run_at) AS run_at
  FROM `delayed_jobs`
  WHERE `delayed_jobs`.`locked_at` IS NULL
    AND `delayed_jobs`.`failed_at` IS NULL
    AND `delayed_jobs`.`run_at` <= '2025-11-10 17:20:13'
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, `delayed_jobs`.`queue`
SNAP

snapshots["runs the expected mysql2 query for working_count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, `delayed_jobs`.`queue` AS delayed_jobs_queue
  FROM `delayed_jobs`
  WHERE `delayed_jobs`.`locked_at` IS NOT NULL
    AND `delayed_jobs`.`failed_at` IS NULL
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, `delayed_jobs`.`queue`
SNAP

snapshots["runs the expected mysql2 query for workable_count 1"] = <<-SNAP
SELECT COUNT(*) AS count_all, CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END AS case_when_priority_0_and_priority_10_then_0_when_priority_10_an, `delayed_jobs`.`queue` AS delayed_jobs_queue
  FROM `delayed_jobs`
  WHERE `delayed_jobs`.`locked_at` IS NULL
    AND `delayed_jobs`.`failed_at` IS NULL
    AND `delayed_jobs`.`run_at` <= '2025-11-10 17:20:13'
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, `delayed_jobs`.`queue`
SNAP

snapshots["runs the expected mysql2 query for alert_age_percent 1"] = <<-SNAP
SELECT (CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END) AS priority, queue, MIN(run_at) AS run_at
  FROM `delayed_jobs`
  WHERE `delayed_jobs`.`locked_at` IS NULL
    AND `delayed_jobs`.`failed_at` IS NULL
    AND `delayed_jobs`.`run_at` <= '2025-11-10 17:20:13'
  GROUP BY CASE WHEN priority >= 0
    AND priority < 10 THEN 0 WHEN priority >= 10
    AND priority < 20 THEN 10 WHEN priority >= 20
    AND priority < 30 THEN 20 WHEN priority >= 30 THEN 30 END, `delayed_jobs`.`queue`
SNAP
