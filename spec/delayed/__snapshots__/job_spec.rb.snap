snapshots["generates the expected postgresql query 1"] = <<-SNAP
SELECT \"delayed_jobs\".*
  FROM \"delayed_jobs\"
  WHERE (\"delayed_jobs\".\"run_at\" <= '2025-11-10 17:20:13'
    AND (\"delayed_jobs\".\"locked_at\" IS NULL OR \"delayed_jobs\".\"locked_at\" < '2025-11-10 16:59:43') OR \"delayed_jobs\".\"locked_by\" = 'worker1')
    AND \"delayed_jobs\".\"failed_at\" IS NULL
  ORDER BY \"delayed_jobs\".\"priority\" ASC, \"delayed_jobs\".\"run_at\" ASC
SNAP

snapshots["generates the expected postgresql query plan 1"] = <<-SNAP
Index Scan using delayed_jobs_priority on public.delayed_jobs  (cost=...)
  Output: id, priority, attempts, handler, last_error, run_at, locked_at, failed_at, locked_by, queue, created_at, updated_at, name
  Filter: ((delayed_jobs.failed_at IS NULL) AND (((delayed_jobs.run_at <= '2025-11-10 17:20:13'::timestamp without time zone) AND ((delayed_jobs.locked_at IS NULL) OR (delayed_jobs.locked_at < '2025-11-10 16:59:43'::timestamp without time zone))) OR ((delayed_jobs.locked_by)::text = 'worker1'::text)))
SNAP

snapshots["generates the expected postgresql query for one queue 1"] = <<-SNAP
SELECT \"delayed_jobs\".*
  FROM \"delayed_jobs\"
  WHERE (\"delayed_jobs\".\"run_at\" <= '2025-11-10 17:20:13'
    AND (\"delayed_jobs\".\"locked_at\" IS NULL OR \"delayed_jobs\".\"locked_at\" < '2025-11-10 16:59:43') OR \"delayed_jobs\".\"locked_by\" = 'worker1')
    AND \"delayed_jobs\".\"failed_at\" IS NULL
    AND \"delayed_jobs\".\"queue\" = 'default'
  ORDER BY \"delayed_jobs\".\"priority\" ASC, \"delayed_jobs\".\"run_at\" ASC
SNAP

snapshots["generates a postgresql query plan for one queue 1"] = <<-SNAP
Index Scan using delayed_jobs_priority on public.delayed_jobs  (cost=...)
  Output: id, priority, attempts, handler, last_error, run_at, locked_at, failed_at, locked_by, queue, created_at, updated_at, name
  Filter: ((delayed_jobs.failed_at IS NULL) AND ((delayed_jobs.queue)::text = 'default'::text) AND (((delayed_jobs.run_at <= '2025-11-10 17:20:13'::timestamp without time zone) AND ((delayed_jobs.locked_at IS NULL) OR (delayed_jobs.locked_at < '2025-11-10 16:59:43'::timestamp without time zone))) OR ((delayed_jobs.locked_by)::text = 'worker1'::text)))
SNAP

snapshots["generates the expected postgresql query for multiple queue 1"] = <<-SNAP
SELECT \"delayed_jobs\".*
  FROM \"delayed_jobs\"
  WHERE (\"delayed_jobs\".\"run_at\" <= '2025-11-10 17:20:13'
    AND (\"delayed_jobs\".\"locked_at\" IS NULL OR \"delayed_jobs\".\"locked_at\" < '2025-11-10 16:59:43') OR \"delayed_jobs\".\"locked_by\" = 'worker1')
    AND \"delayed_jobs\".\"failed_at\" IS NULL
    AND \"delayed_jobs\".\"queue\" IN ('default', 'mailers', 'tracking')
  ORDER BY \"delayed_jobs\".\"priority\" ASC, \"delayed_jobs\".\"run_at\" ASC
SNAP

snapshots["generates a postgresql query plan for multiple queues 1"] = <<-SNAP
Index Scan using delayed_jobs_priority on public.delayed_jobs  (cost=...)
  Output: id, priority, attempts, handler, last_error, run_at, locked_at, failed_at, locked_by, queue, created_at, updated_at, name
  Filter: ((delayed_jobs.failed_at IS NULL) AND ((delayed_jobs.queue)::text = ANY ('{default,mailers,tracking}'::text[])) AND (((delayed_jobs.run_at <= '2025-11-10 17:20:13'::timestamp without time zone) AND ((delayed_jobs.locked_at IS NULL) OR (delayed_jobs.locked_at < '2025-11-10 16:59:43'::timestamp without time zone))) OR ((delayed_jobs.locked_by)::text = 'worker1'::text)))
SNAP

snapshots["generates the expected sqlite3 query 1"] = <<-SNAP
SELECT \"delayed_jobs\".*
  FROM \"delayed_jobs\"
  WHERE (\"delayed_jobs\".\"run_at\" <= '2025-11-10 17:20:13'
    AND (\"delayed_jobs\".\"locked_at\" IS NULL OR \"delayed_jobs\".\"locked_at\" < '2025-11-10 16:59:43') OR \"delayed_jobs\".\"locked_by\" = 'worker1')
    AND \"delayed_jobs\".\"failed_at\" IS NULL
  ORDER BY \"delayed_jobs\".\"priority\" ASC, \"delayed_jobs\".\"run_at\" ASC
SNAP

snapshots["generates the expected sqlite3 query plan 1"] = <<-SNAP
SCAN delayed_jobs USING INDEX delayed_jobs_priority
SNAP

snapshots["generates the expected sqlite3 query for one queue 1"] = <<-SNAP
SELECT \"delayed_jobs\".*
  FROM \"delayed_jobs\"
  WHERE (\"delayed_jobs\".\"run_at\" <= '2025-11-10 17:20:13'
    AND (\"delayed_jobs\".\"locked_at\" IS NULL OR \"delayed_jobs\".\"locked_at\" < '2025-11-10 16:59:43') OR \"delayed_jobs\".\"locked_by\" = 'worker1')
    AND \"delayed_jobs\".\"failed_at\" IS NULL
    AND \"delayed_jobs\".\"queue\" = 'default'
  ORDER BY \"delayed_jobs\".\"priority\" ASC, \"delayed_jobs\".\"run_at\" ASC
SNAP

snapshots["generates a sqlite3 query plan for one queue 1"] = <<-SNAP
SCAN delayed_jobs USING INDEX delayed_jobs_priority
SNAP

snapshots["generates the expected sqlite3 query for multiple queue 1"] = <<-SNAP
SELECT \"delayed_jobs\".*
  FROM \"delayed_jobs\"
  WHERE (\"delayed_jobs\".\"run_at\" <= '2025-11-10 17:20:13'
    AND (\"delayed_jobs\".\"locked_at\" IS NULL OR \"delayed_jobs\".\"locked_at\" < '2025-11-10 16:59:43') OR \"delayed_jobs\".\"locked_by\" = 'worker1')
    AND \"delayed_jobs\".\"failed_at\" IS NULL
    AND \"delayed_jobs\".\"queue\" IN ('default', 'mailers', 'tracking')
  ORDER BY \"delayed_jobs\".\"priority\" ASC, \"delayed_jobs\".\"run_at\" ASC
SNAP

snapshots["generates a sqlite3 query plan for multiple queues 1"] = <<-SNAP
SCAN delayed_jobs USING INDEX delayed_jobs_priority
SNAP

snapshots["generates the expected mysql2 query 1"] = <<-SNAP
SELECT `delayed_jobs`.*
  FROM `delayed_jobs`
  WHERE (`delayed_jobs`.`run_at` <= '2025-11-10 17:20:13'
    AND (`delayed_jobs`.`locked_at` IS NULL OR `delayed_jobs`.`locked_at` < '2025-11-10 16:59:43') OR `delayed_jobs`.`locked_by` = 'worker1')
    AND `delayed_jobs`.`failed_at` IS NULL
  ORDER BY `delayed_jobs`.`priority` ASC, `delayed_jobs`.`run_at` ASC
SNAP

snapshots["generates the expected mysql2 query plan 1"] = <<-SNAP
-> Sort: delayed_jobs.priority, delayed_jobs.run_at  (cost=...)
    -> Filter: ((((delayed_jobs.run_at <= TIMESTAMP'2025-11-10 17:20:13') and ((delayed_jobs.locked_at is null) or (delayed_jobs.locked_at < TIMESTAMP'2025-11-10 16:59:43'))) or (delayed_jobs.locked_by = 'worker1')) and (delayed_jobs.failed_at is null))  (cost=...)
        -> Table scan on delayed_jobs  (cost=...)
SNAP

snapshots["generates the expected mysql2 query for one queue 1"] = <<-SNAP
SELECT `delayed_jobs`.*
  FROM `delayed_jobs`
  WHERE (`delayed_jobs`.`run_at` <= '2025-11-10 17:20:13'
    AND (`delayed_jobs`.`locked_at` IS NULL OR `delayed_jobs`.`locked_at` < '2025-11-10 16:59:43') OR `delayed_jobs`.`locked_by` = 'worker1')
    AND `delayed_jobs`.`failed_at` IS NULL
    AND `delayed_jobs`.`queue` = 'default'
  ORDER BY `delayed_jobs`.`priority` ASC, `delayed_jobs`.`run_at` ASC
SNAP

snapshots["generates a mysql2 query plan for one queue 1"] = <<-SNAP
-> Sort: delayed_jobs.priority, delayed_jobs.run_at  (cost=...)
    -> Filter: ((delayed_jobs.queue = 'default') and (((delayed_jobs.run_at <= TIMESTAMP'2025-11-10 17:20:13') and ((delayed_jobs.locked_at is null) or (delayed_jobs.locked_at < TIMESTAMP'2025-11-10 16:59:43'))) or (delayed_jobs.locked_by = 'worker1')) and (delayed_jobs.failed_at is null))  (cost=...)
        -> Table scan on delayed_jobs  (cost=...)
SNAP

snapshots["generates the expected mysql2 query for multiple queue 1"] = <<-SNAP
SELECT `delayed_jobs`.*
  FROM `delayed_jobs`
  WHERE (`delayed_jobs`.`run_at` <= '2025-11-10 17:20:13'
    AND (`delayed_jobs`.`locked_at` IS NULL OR `delayed_jobs`.`locked_at` < '2025-11-10 16:59:43') OR `delayed_jobs`.`locked_by` = 'worker1')
    AND `delayed_jobs`.`failed_at` IS NULL
    AND `delayed_jobs`.`queue` IN ('default', 'mailers', 'tracking')
  ORDER BY `delayed_jobs`.`priority` ASC, `delayed_jobs`.`run_at` ASC
SNAP

snapshots["generates a mysql2 query plan for multiple queues 1"] = <<-SNAP
-> Sort: delayed_jobs.priority, delayed_jobs.run_at  (cost=...)
    -> Filter: ((((delayed_jobs.run_at <= TIMESTAMP'2025-11-10 17:20:13') and ((delayed_jobs.locked_at is null) or (delayed_jobs.locked_at < TIMESTAMP'2025-11-10 16:59:43'))) or (delayed_jobs.locked_by = 'worker1')) and (delayed_jobs.failed_at is null) and (delayed_jobs.queue in ('default','mailers','tracking')))  (cost=...)
        -> Table scan on delayed_jobs  (cost=...)
SNAP
